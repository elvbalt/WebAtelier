/**
 * Web Atelier 2023  Exercise 5 - Web Apps with Express.js
 *
 * Student: __Elvira Baltasar__
 *
 * Tasks 4 and 5
 *
*/

let map = <%-JSON.stringify(map)%>;

let layer = initMapTiles(map_obj, map);


function SyncTilesToMap() {
    let tiles = form2obj().tiles;
    if (layer) { layer.remove(); }
    layer = initMapTiles({tiles}, map);
}

/**
     * Reads the form data and returns a map object with the title, zoom, center and tiles fields.
     * @returns {Object} the map object based on the form data (TODO)
     */
function form2obj() {

    let title = document.getElementById("title").value;
    let zoom = parseInt(document.getElementById("zoom").value);
    let lat = parseFloat(document.getElementById("lat").value);
    let lng = parseFloat(document.getElementById("lng").value);
    let tiles = document.getElementById("tiles").value;

        return {
            //TODO construct the map object from the above values
            "zoom": zoom,
            "title": title,
            "tiles": tiles,
            "center": {
                "lat": lat,
                "lng": lng
            }
        }
    }

    /**
     * Updates the map from the form input values;
     */
    function SyncFormToMap() {
        let map_obj = form2obj();
        map.setView([map_obj.center.lat, map_obj.center.lng], map_obj.zoom);
        SyncTilesToMap()
    }

    /**
     * Updates the form input values from the map;
     */
    function SyncMapToForm() {
        var zoom = map.getZoom();
        var center = map.getCenter();
        //TODO update the values of the corresponding form input fields
        document.getElementById("zoom").value = zoom;
        document.getElementById("lat").value = center.lat;
        document.getElementById("lng").value = center.lng;
    }

    //Initialize the form input fields from the map object
    SyncMapToForm();
    document.getElementById("tiles").value = map_obj.tiles;
    document.getElementById("title").value = map_obj.title;

    //TODO setup the zoomend and moveend event listeners for the map
    map.on('zoomend', SyncMapToForm);
    map.on('moveend', SyncMapToForm);

